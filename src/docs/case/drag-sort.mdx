# DragSort 拖拽排序

鼠标按下拖拽

## 核心API

- draggable：使目标元素可以进行拖拽
- onDragStart：用户在拖拽开始时触发
- onDragEnter：可拖动元素进入目标元素区域时触发
- onDragEnd：拖拽结束时触发
- onDragOver：可拖动元素进入目标元素区域时**连续**触发

## 逻辑解析

1. 首先需要将元素变成可以拖拽的元素，因此需要设置draggable=true
2. 通过onDragStart拿到拖拽元素
3. 当拖拽元素进入到目标区域时对列表重新排序
4. 清除事件

## 注意

1. 需要为每个元素还有父级元素添加onDragOver事件，否则会出现禁止图标
2. 在拖拽时使用setTimeout添加类名可以使拖拽中的元素和原本元素展现出不同的样式

## 代码如下

```jsx
import React, { useState } from 'react';

interface Item {
    id: number;
    name: string;
}

const DragSort: React.FC = () => {
    const [items, setItems] = useState<Item[]>([
        { id: 1, name: 'Item 1' },
        { id: 2, name: 'Item 2' },
        { id: 3, name: 'Item 3' },
        { id: 4, name: 'Item 4' },
        { id: 5, name: 'Item 5' },
    ]);
    const [dragItem, setDragItem] = useState<Item | null>(null);
    const dragStartHandler = (e: React.DragEvent, item: Item) => {
        setTimeout(() => {
            (e.target as HTMLElement).classList.add('bg-gray-300');
        }, 0);

        setDragItem(item);
    };
    const dragEndHandler = (e: React.DragEvent) => {
        setTimeout(() => {
            (e.target as HTMLElement).classList.remove('bg-gray-300');
        }, 0);
        setDragItem(null);
    };
    const onDragEnterHandler = (e: React.DragEvent, item: Item) => {
        e.preventDefault();
        if (!dragItem || (dragItem && dragItem.id === item.id)) return;
        const dragIndex = items.findIndex((e) => e.id === dragItem.id);
        const itemIndex = items.findIndex((e) => e.id === item.id);
        const newItems = [...items];
        const temp = newItems[itemIndex];
        newItems[itemIndex] = dragItem;
        newItems[dragIndex] = temp;
        setItems(newItems);
    };

    return (
        <div>
            <h1>拖拽排序</h1>
            <div
                className="w-full mx-auto p-4 bg-gray-50 rounded-lg"
                onDragOver={(e) => e.preventDefault()}
            >
                {items.map((item) => (
                    <div
                        key={item.id}
                        draggable
                        onDragStart={(e) => dragStartHandler(e, item)}
                        onDragEnter={(e) => onDragEnterHandler(e, item)}
                        onDragEnd={(e) => dragEndHandler(e)}
                        onDragOver={(e) => e.preventDefault()}
                        className={`w-full h-12 bg-blue-100 hover:bg-blue-200
                                  mb-2 rounded-md flex items-center justify-center
                                  border border-blue-300 transition-all duration-200
                                  cursor-grab active:cursor-grabbing`}
                    >
                        {item.name}
                    </div>
                ))}
            </div>
        </div>
    );
};

export default DragSort;

```
